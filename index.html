<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  </head>
  <body>
    <div class="container">    
      <!-- Start modal -->
      <div class="modal" id="wndComics" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="title">Comics</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="content">
              
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
      <!-- end modal -->
      <h1 class="text-center mt-2">Welcome to the Marvel Universe</h1>
      <div>
        <div id="topPages"></div>
        <div id="lista" class="row"></div>  
        <div id="bottonPages"></div>
      </div>
    </div>
</div>
  </body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	  <script src="./assets/javascript/md5.js"></script>
	
    <script>
      const RECORDS_PER_PAGE = 20;
      const PAGES_PER_SET = 10;
        /* 
            This is only for demo purposes, keep your keys secret! 
            safe place
        */
        const PUBLIC_KEY = "bed36f9be4c7facb27bb847b703b9a01";
        const PRIVATE_KEY = "2503ada6a059f6566aeceb12807bdfedaf554e33";

        const fetchComics=((id,name)=>{
          const ts = Date.now();
          var hash = md5(ts + PRIVATE_KEY + PUBLIC_KEY);
          
          const URL = `http://gateway.marvel.com/v1/public/characters/${id}/comics?ts=${ts}&apikey=${PUBLIC_KEY}&hash=${hash}`;
          const lista = document.querySelector("#lista");

          fetch(URL)
              .then(response => response.json())
              .then(data => {
                const myModal = new bootstrap.Modal(document.getElementById('wndComics'), {
                  keyboard: false
                });

                let content = document.querySelector("#content");
                let title = document.querySelector("#title");
                title.innerHTML = name + " Comics";
                let templateComics = `<ul>`;
                data.data.results.forEach(comic => {
                  console.log(comic);
                  templateComics += `
                    <li>${comic.title}</li>                    
                  `;
                });
                content.innerHTML = templateComics + `</ul>`;
                myModal.show();
                
              })
              .catch(error =>{
                console.log(error)
              });
        });
          
        

        const fetchData=((pageNumber)=>{
          const ts = Date.now();
          var hash = md5(ts + PRIVATE_KEY + PUBLIC_KEY);

          const URL = `http://gateway.marvel.com/v1/public/characters?ts=${ts}&apikey=${PUBLIC_KEY}&hash=${hash}`;
          const lista = document.querySelector("#lista");

          fetch(URL)
              .then(response => response.json())
              .then(data => {
                const totalRecords = data.data.total;
                //const currentPage = 1;
                data.data.results.forEach(hero => {
                  let templateHero =   `<div class="p-3" style="width: 19rem;"><div class="card col-md-4 shadow" style="width: 18rem;">
                                      <img src="${hero.thumbnail.path}.${hero.thumbnail.extension}" class="card-img-top" alt="...">
                                      <div class="card-body">
                                        <h5 class="card-title">${hero.name}</h5>
                                        <p class="card-text">${hero.description}</p>
                                        <a href="#" onclick="handlerComics(${hero.id},'${hero.name}');" class="btn btn-primary">Comics</a>
                                      </div>
                                    </div> </div>`; 
                  lista.innerHTML += templateHero;
              })
              .catch(error =>{
                console.log(error)
              });
          });
          
        });
          //generate ramdom
          
        const handlerComics=((id,name)=>{
          
          fetchComics(id,name);
          
        });  
     
      fetchData(); //load data when page is loaded

    </script>
</html>